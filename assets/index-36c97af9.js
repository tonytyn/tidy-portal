import{c as T,u as L,g as S,a as z,s as P,U as j,d as O}from"./index-9b86b89f.js";import{d as D,r,a as t,o as v,i as V,w as o,b as a,e as F,f,m as R,j as q,c as w,t as A,F as $,k as G,u as H,l as K,_ as J}from"./index-7b414364.js";import{g as Q}from"./index-f79d3f90.js";import"./request-ad0d4e71.js";const W={style:{"text-align":"center"}},X=D({__name:"CreateRole",props:{modalVisible:Boolean},emits:["modalClose"],setup(x,{emit:b}){const p=b,y=r(),d=r({roleName:""}),n=async()=>{const{data:s}=await T(d.value);if(s.code!==0)return R.error(s.msg);R.success(s.msg),setTimeout(()=>{y.value.resetFields(),p("modalClose")},1e3)},k=()=>{p("modalClose")};return(s,u)=>{const C=t("a-input"),N=t("a-form-item"),h=t("a-button"),m=t("a-form"),l=t("a-modal");return v(),V(l,{open:x.modalVisible,title:"创建角色",onCancel:k,footer:null},{default:o(()=>[a(m,{ref_key:"formRef",ref:y,model:d.value,"label-col":{span:5},"wrapper-col":{span:15}},{default:o(()=>[a(N,{label:"角色名称",name:"roleName"},{default:o(()=>[a(C,{value:d.value.roleName,"onUpdate:value":u[0]||(u[0]=e=>d.value.roleName=e)},null,8,["value"])]),_:1}),F("div",W,[a(h,{type:"primary",onClick:n},{default:o(()=>[f("提交")]),_:1})])]),_:1},8,["model"])]),_:1},8,["open"])}}}),Y={key:0,style:{color:"#1890ff"}},Z={style:{"text-align":"center"}},ee=D({__name:"EditRole",props:{modalVisible:Boolean,roleId:Number},emits:["modalClose"],setup(x,{emit:b}){const p=x,y=r(),d=r({id:0,roleName:"",state:"",createdAt:""}),n=r({id:0,roleName:"",state:"",menuIds:[]}),k=r([]),s=r([]),u=r([]);q(p,async()=>{if(p.modalVisible){const{data:l}=await S(p.roleId);d.value=l.data,n.value.roleName=l.data.roleName,n.value.state=l.data.state;const{data:e}=await Q();k.value=e.data,u.value=C(k.value,new Array);const{data:i}=await z(p.roleId);s.value=i.data.filter(_=>u.value.includes(_))}});const C=(l,e)=>(l.forEach(i=>{var _;(_=i==null?void 0:i.children)!=null&&_.length?C(i.children,e):e.push(i.key)}),e),N=async()=>{n.value.menuIds=s.value.filter(e=>u.value.includes(e));const{data:l}=await L(n.value);if(l.code!==0)return R.error(l.msg);R.success(l.msg),y.value.resetFields(),h("modalClose")},h=b,m=()=>{h("modalClose")};return(l,e)=>{const i=t("a-input"),_=t("a-form-item"),I=t("a-tree"),M=t("a-switch"),B=t("a-form"),U=t("a-button"),g=t("a-modal");return v(),V(g,{open:x.modalVisible,title:"角色详情",onCancel:m,footer:null},{default:o(()=>[a(B,{ref_key:"formRef",ref:y,model:d.value,"label-col":{span:5},"wrapper-col":{span:15}},{default:o(()=>[a(_,{label:"角色名称",name:"roleName"},{default:o(()=>[a(i,{value:n.value.roleName,"onUpdate:value":e[0]||(e[0]=c=>n.value.roleName=c)},null,8,["value"])]),_:1}),a(_,{label:"绑定菜单",name:"menus"},{default:o(()=>[a(I,{checkedKeys:s.value,"onUpdate:checkedKeys":e[1]||(e[1]=c=>s.value=c),checkable:"",selectable:!1,"tree-data":k.value},{title:o(({title:c,key:E})=>[E==="0-0-1-0"?(v(),w("span",Y,A(c),1)):(v(),w($,{key:1},[f(A(c),1)],64))]),_:1},8,["checkedKeys","tree-data"])]),_:1}),a(_,{label:"状态",name:"state"},{default:o(()=>[a(M,{checked:n.value.state,"onUpdate:checked":e[2]||(e[2]=c=>n.value.state=c),checkedValue:"启用",unCheckedValue:"停用"},null,8,["checked"])]),_:1})]),_:1},8,["model"]),F("div",Z,[a(U,{type:"primary",onClick:N},{default:o(()=>[f("提交")]),_:1})])]),_:1},8,["open"])}}}),ae={name:"Role"},te=D({...ae,setup(x){const b=r([]),p=[{title:"角色名称",dataIndex:"roleName",align:"center"},{key:"state",title:"状态",dataIndex:"state",align:"center"},{key:"createdAt",title:"创建日期",dataIndex:"createdAt",align:"center"},{key:"operation",title:"操作",align:"center"}],y=async()=>{const{data:m}=await P();b.value=m.data},d=r(!1),n=()=>{d.value=!0},k=()=>{d.value=!1},s=r(0),u=r(!1),C=m=>{s.value=m,u.value=!0},N=()=>{u.value=!1},h=async m=>{const{data:l}=await O(m);R.success(l.msg)};return y(),(m,l)=>{const e=t("a-button"),i=t("a-divider"),_=t("a-tag"),I=t("a-popconfirm"),M=t("a-space"),B=t("a-table");return v(),w($,null,[a(e,{type:"primary",icon:G(H(j)),onClick:n},{default:o(()=>[f(" 创建角色 ")]),_:1},8,["icon"]),a(i),a(B,{columns:p,"data-source":b.value,pagination:!1,rowKey:"id",bordered:""},{bodyCell:o(({index:U,record:g,column:c})=>[c.key==="index"?(v(),w($,{key:0},[f(A(U+1),1)],64)):K("",!0),c.key==="state"?(v(),V(_,{key:1,color:g.state==="启用"?"success":"error"},{default:o(()=>[f(A(g.state),1)]),_:2},1032,["color"])):K("",!0),c.key==="operation"?(v(),V(M,{key:2},{default:o(()=>[a(e,{type:"primary",size:"small",onClick:E=>C(g.id)},{default:o(()=>[f("编辑")]),_:2},1032,["onClick"]),a(I,{title:"确定要删除这个角色吗？","ok-text":"是的","cancel-text":"我再想想",onConfirm:E=>h(g.id)},{default:o(()=>[a(e,{type:"primary",size:"small"},{default:o(()=>[f("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):K("",!0)]),_:1},8,["data-source"]),a(X,{modalVisible:d.value,onModalClose:k},null,8,["modalVisible"]),a(ee,{modalVisible:u.value,roleId:s.value,onModalClose:N},null,8,["modalVisible","roleId"])],64)}}});const ce=J(te,[["__scopeId","data-v-9e64d648"]]);export{ce as default};
