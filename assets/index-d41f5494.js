import{c as T,u as L,g as S,a as z,s as P,U as j,d as O}from"./index-d258ee4d.js";import{d as $,r,a as o,o as k,i as R,w as l,b as e,e as D,f as y,m as N,j as q,c as V,t as w,F as K,k as G,u as H,l as E,_ as J}from"./index-17f23244.js";import{g as Q}from"./index-2b6ba8f0.js";import"./request-c09486d7.js";const W={style:{"text-align":"center"}},X=$({__name:"CreateRole",props:{modalVisible:Boolean},emits:["modalClose"],setup(C,{emit:f}){const m=r(),_=r({roleName:""}),v=async()=>{const{data:d}=await T(_.value);if(d.code!==0)return N.error(d.msg);N.success(d.msg),setTimeout(()=>{m.value.resetFields(),f("modalClose")},1e3)},c=()=>{f("modalClose")};return(d,i)=>{const p=o("a-input"),b=o("a-form-item"),h=o("a-button"),g=o("a-form"),a=o("a-modal");return k(),R(a,{open:C.modalVisible,title:"创建角色",onCancel:c,footer:null},{default:l(()=>[e(g,{ref_key:"formRef",ref:m,model:_.value,"label-col":{span:5},"wrapper-col":{span:15}},{default:l(()=>[e(b,{label:"角色名称",name:"roleName"},{default:l(()=>[e(p,{value:_.value.roleName,"onUpdate:value":i[0]||(i[0]=t=>_.value.roleName=t)},null,8,["value"])]),_:1}),D("div",W,[e(h,{type:"primary",onClick:v},{default:l(()=>[y("提交")]),_:1})])]),_:1},8,["model"])]),_:1},8,["open"])}}}),Y={key:0,style:{color:"#1890ff"}},Z={style:{"text-align":"center"}},ee=$({__name:"EditRole",props:{modalVisible:Boolean,roleId:Number},emits:["modalClose"],setup(C,{emit:f}){const m=C,_=r(),v=r({id:0,roleName:"",state:"",createdAt:""}),c=r({id:0,roleName:"",state:"",menuIds:[]}),d=r([]),i=r([]),p=r([]);q(m,async()=>{if(m.modalVisible){const{data:a}=await S(m.roleId);v.value=a.data,c.value.roleName=a.data.roleName,c.value.state=a.data.state;const{data:t}=await Q();d.value=t.data,p.value=b(d.value,new Array);const{data:n}=await z(m.roleId);i.value=n.data.filter(u=>p.value.includes(u))}});const b=(a,t)=>(a.forEach(n=>{var u;(u=n==null?void 0:n.children)!=null&&u.length?b(n.children,t):t.push(n.key)}),t),h=async()=>{c.value.menuIds=i.value.filter(t=>p.value.includes(t));const{data:a}=await L(c.value);if(a.code!==0)return N.error(a.msg);N.success(a.msg),_.value.resetFields(),f("modalClose")},g=()=>{f("modalClose")};return(a,t)=>{const n=o("a-input"),u=o("a-form-item"),A=o("a-tree"),I=o("a-switch"),M=o("a-form"),B=o("a-button"),U=o("a-modal");return k(),R(U,{open:C.modalVisible,title:"角色详情",onCancel:g,footer:null},{default:l(()=>[e(M,{ref_key:"formRef",ref:_,model:v.value,"label-col":{span:5},"wrapper-col":{span:15}},{default:l(()=>[e(u,{label:"角色名称",name:"roleName"},{default:l(()=>[e(n,{value:c.value.roleName,"onUpdate:value":t[0]||(t[0]=s=>c.value.roleName=s)},null,8,["value"])]),_:1}),e(u,{label:"绑定菜单",name:"menus"},{default:l(()=>[e(A,{checkedKeys:i.value,"onUpdate:checkedKeys":t[1]||(t[1]=s=>i.value=s),checkable:"",selectable:!1,"tree-data":d.value},{title:l(({title:s,key:x})=>[x==="0-0-1-0"?(k(),V("span",Y,w(s),1)):(k(),V(K,{key:1},[y(w(s),1)],64))]),_:1},8,["checkedKeys","tree-data"])]),_:1}),e(u,{label:"状态",name:"state"},{default:l(()=>[e(I,{checked:c.value.state,"onUpdate:checked":t[2]||(t[2]=s=>c.value.state=s),checkedValue:"启用",unCheckedValue:"停用"},null,8,["checked"])]),_:1})]),_:1},8,["model"]),D("div",Z,[e(B,{type:"primary",onClick:h},{default:l(()=>[y("提交")]),_:1})])]),_:1},8,["open"])}}}),ae={name:"Role"},te=$({...ae,setup(C){const f=r([]),m=[{title:"角色名称",dataIndex:"roleName",align:"center"},{key:"state",title:"状态",dataIndex:"state",align:"center"},{key:"createdAt",title:"创建日期",dataIndex:"createdAt",align:"center"},{key:"operation",title:"操作",align:"center"}],_=async()=>{const{data:a}=await P();f.value=a.data},v=r(!1),c=()=>{v.value=!0},d=()=>{v.value=!1},i=r(0),p=r(!1),b=a=>{i.value=a,p.value=!0},h=()=>{p.value=!1},g=async a=>{const{data:t}=await O(a);N.success(t.msg)};return _(),(a,t)=>{const n=o("a-button"),u=o("a-divider"),A=o("a-tag"),I=o("a-popconfirm"),M=o("a-space"),B=o("a-table");return k(),V(K,null,[e(n,{type:"primary",icon:G(H(j)),onClick:c},{default:l(()=>[y(" 创建角色 ")]),_:1},8,["icon"]),e(u),e(B,{columns:m,"data-source":f.value,pagination:!1,rowKey:"id",bordered:""},{bodyCell:l(({index:U,record:s,column:x})=>[x.key==="index"?(k(),V(K,{key:0},[y(w(U+1),1)],64)):E("",!0),x.key==="state"?(k(),R(A,{key:1,color:s.state==="启用"?"success":"error"},{default:l(()=>[y(w(s.state),1)]),_:2},1032,["color"])):E("",!0),x.key==="operation"?(k(),R(M,{key:2},{default:l(()=>[e(n,{type:"primary",size:"small",onClick:F=>b(s.id)},{default:l(()=>[y("编辑")]),_:2},1032,["onClick"]),e(I,{title:"确定要删除这个角色吗？","ok-text":"是的","cancel-text":"我再想想",onConfirm:F=>g(s.id)},{default:l(()=>[e(n,{type:"primary",size:"small"},{default:l(()=>[y("删除")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):E("",!0)]),_:1},8,["data-source"]),e(X,{modalVisible:v.value,onModalClose:d},null,8,["modalVisible"]),e(ee,{modalVisible:p.value,roleId:i.value,onModalClose:h},null,8,["modalVisible","roleId"])],64)}}});const ce=J(te,[["__scopeId","data-v-511e43d0"]]);export{ce as default};
